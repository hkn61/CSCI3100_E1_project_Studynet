<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="{% static 'task/report.js' %}"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js" integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="{% static 'style.css' %}" />
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.1.min.js"></script>
    <title>Document</title>
</head>
<body>
      <ul class = "navbar">
          <li class = "nav_of_group"><a href="/task/tasklist">My Task</a></li>
          <li ><a href="/chat/grouplist">My Friends/Groups</a></li>
          <li><a href="/user/profile">My Profile</a></li>
      </ul>
<div class="content-body">
        <div class="sideBar"  >
              <div  class="sideBar-item" onclick="location.href='/task/tasklist'" ><p><br><i class="bi bi-person-plus-fill" style="font-size: 30px"></i><br>Task list</p></div>
              <div  class="sideBar-item" onclick="location.href='/task/showdeletedtask'"><p><br><i class="bi bi-card-list" style="font-size: 30px"></i><br>Deleted Task</P></div>
              <div  class="sideBar-item" onclick="location.href='/task/showfinishedtask'"><p><br><i class="bi bi-chat-left-text-fill" style="font-size: 30px"></i><br>Finished Task</P></div>
            <div  class="sideBar-item" onclick="location.href='/task/timer'"><p><br><i class="bi bi-chat-left-text-fill" style="font-size: 30px"></i><br>Begin Task</P></div>
            <div  class="sideBar-item" onclick="location.href='/task/report'"><p><br><i class="bi bi-chat-left-text-fill" style="font-size: 30px"></i><br>Report</P></div>
          </div>
        <div class="header">
            <h2 style="color: #6371c5"> Report</h2>
            <br>
            {% csrf_token %}
            <label for="report_date" style="color: #6371c5">Select a date</label>
            <input type="date" id="report_date" name="date" >

            <canvas id="myChart" style="height:400px; width:1200px" ></canvas>
<!--            <canvas id="pieChart" style="height:200px; width:1500px" ></canvas>-->

        </div>
    </div>
    <script>
        document.querySelector('#report_date').addEventListener('input',getdatedata)

        function getdatedata(e){
            const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            const formData = new FormData();
            formData.append('date', e.target.value);
            fetch("get_report_data", {
                headers:{'X-CSRFToken': csrftoken},
                method: 'POST',
                credentials: 'same-origin',
                body: formData,
            }).then(response=>response.json())
                .then(data=>{
                    var chartjsData = [];

            for (var i = 0; i < data.length; i++) {
                chartjsData.push(data[i].timespent);
            }
            var chartjslabel = [];
            for (var i = 0; i < data.length; i++) {
                chartjslabel.push(data[i].taskname);
            }
        //生成图表
        $('#myChart').remove(); // this is my <canvas> element
        $('.header').append('<canvas id="myChart" style="height:400px; width:1200px" ></canvas>');
            ctx = document.getElementById("myChart").getContext("2d");
                    var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: chartjslabel,
                datasets:  [
                        {
                            label: "Finished tasks",
                            fillColor : "rgba(220,280,220,0.5)",
                            strokeColor : "rgba(220,220,220,1)",
                            data : chartjsData
                        }
                    ]
            },
            options: {
                layout:{
                   padding: {
                        left:400,
                        top:100
                    },
                },
                responsive:false,
                plugins:{
                    title:{
                    display:true,
                    text:"Task Time"
                },

                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });


            })
        }
        // var json = [
        //     {"taskname":"project A",
        //     "timespent":"100"},
        //     {"taskname":"projectB","timespent":"200"},
        //     {"taskname":"project c","timespent":"300"}];
        //     // 分成两个list


//倒出几类task的数目做饼状图
// var json2 =[    {"classname":"finished","number":"100"},
// {"classname":"unfinished","number":"200"},
// {"classname":"deleted","number":"300"}
//
// ];
// var chart2jsData = [];
//     for (var i = 0; i < json2.length; i++) {
//         chart2jsData.push(json2[i].number);
//     }
//     var chart2jslabel = [];
//     for (var i = 0; i < json2.length; i++) {
//         chart2jslabel.push(json2[i].classname);
//     }
// var ctx = document.getElementById('pieChart').getContext('2d');
// var pieChart = new Chart(ctx, {
//     type: 'pie',
//     data: {
//         labels: chart2jslabel,
//         datasets:  [
//                 { backgroundColor: ["rgba(220,20,60, 0.8)","rgba(255,130,71,0.8)",'rgba(255, 159, 64, 0.2)'],
//                     data : chart2jsData
//
//                 }
//             ]
//     },
//     options: {
//         layout:{
//            padding: {
//                 left:20,
//                 top:50
//
//             },
//         },
//         responsive:false,
//         title:{
//             display:true,
//             text:"finished:unfinished:deleted"
//         },
//     }
// })

    </script>
</body>
</html>
