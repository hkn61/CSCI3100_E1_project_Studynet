{% extends "chat/group.html" %}

{% block content %}
    <style>
        .sideBar-item-top{
            background: #c4dad8;
        }
          
        .title{
        color: #a8b3be;
        }
        .search-form {
            width: 450px;
        }
        input[type=text] {
            float: center;
            padding: 6px;
            border: 2px solid lightgray;
            margin-top: 8px;
            margin-right: 16px;
            font-size: 20px;
            width: 270px;
            border-radius: 10px;
            height: 40px;
        }
        .button {
            float: center;
            padding: 6px;
            border: 2px solid lightgray;;
            margin-top: 8px;
            margin-right: 16px;
            font-size: 17px;
            width: 50px;
            height: 40px;
            border-radius: 10px;
        }
        
        .listItem {
            background: #c1beaf;
            border-radius: 10px;
            height: 75px;
            width: 350px;
            left: 23%;
            margin-left:30%;
            padding: 20px 20px;
            margin-top: 20px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }
        .create {
            color: #123777;
            
        }
        .create:hover{
            color: #99adce;
        }
        .notice{
            color:#123777;
            text-align: left;
            margin-left:25%;
        }



    </style>
  
        <h1 class="title">StudyNet - Add Friend/Group</h1>
        <h3 >Find new study groups and friends below</h3>
        <form class = "search-form" action="/chat/groupsearch" method="post">
            {% csrf_token %}
            <input class="input" name="groupname" type="text"  placeholder="Search..." required>
            
            <button  class="button" type="submit" >
                <i class="bi bi-search"></i>
            </button>

            <p class="notice"> Please select a serach option:</p>
            <div class="option">
                <input class = "radio" type="radio" name="search_type" value="private_group" required>
                <label> Search by group ID</label>
                <p class="notice"> - join public group or private group (ask the target group member for the private group ID)</p>
            </div>
            <div class="option">
                <input class = "radio" type="radio" name="search_type" value="public_group" required>
                <label> Search by group name</label>
                <p class="notice"> - explore public groups and join freely</p>
            </div>
            <div class="option">
                <input class = "radio" type="radio" name="search_type" value="friend" required>
                <label> Search by friend ID</label>
                <p class="notice"> - add friend, ask your friend for his/her user ID <br></p>
            </div>

        </form>
        
        
        {% block form %}
        <h1>No search result</h1>
        {% endblock %}
        <p><br></p>
        <div id="app">
            <!--<div class="search-result" v-if="showList" >-->
                {% csrf_token %}
                <div class="listItem" @click="addGroup(item)" v-for="item in res_group_list" :key="item" >
                    <p>[[item]]</p>
                </div>
            <!--</div>-->
        </div>
        <p><br></p>
        <h2>No suitable group found? <a onclick="location.href='/chat/groupcreate';"  class="create">CREATE</a> a new group!</h2>
        
        set to be private or public
        ask for group name 
        create cancel
        new group 
        <p><br></p>
        <p><br></p>
        <p><br></p>
        
          
    {{ res_group_list|json_script:"res_group_list" }}
    

  <script>
      
    let res_group_list = JSON.parse(document.getElementById('res_group_list').textContent);
    console.log(res_group_list)
    const app =  Vue.createApp({
        delimiters: ['[[', ']]'],
        el: '#app',
        data() {
            return {
                res_group_list: res_group_list
            }
        },
        methods: {
            addGroup(item){
                console.log(item)
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const formData = new FormData();
                formData.append('groupname', item);
                fetch("groupadd", {
                    headers:{'X-CSRFToken': csrftoken},
                    method: 'POST',
                    body: formData,
                    credentials: 'same-origin'
                })
            }
            
        },
        mounted: function(){
            console.log('== mounted ==')
        }
    });
    app.mount('#app');

      //document.getElementById("listItem-friend").onclick =  function (e){
      //  console.log(e);
      //  friend_list.push({ 'name': 'Wendy', 'ID': 123456, 'photo': 'photo1.jpg' });
      //console.log(friend_list);
      //}
    
      
  </script>
{% endblock %}